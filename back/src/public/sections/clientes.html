<!--clientes.html-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Clientes</title>
</head>
<body>
    <h1>Gestión de Clientes</h1>
    <form id="clienteForm">
        <input type="hidden" id="clienteId">
        <input type="text" id="nombre" placeholder="Nombre" required>
        <input type="text" id="direccion" placeholder="Dirección" required>
        <input type="text" id="ciudad" placeholder="Ciudad" required>
        <input type="text" id="telefono" placeholder="Teléfono" required>
        <input type="email" id="email" placeholder="Email" required>
        <select id="tier">
            <option value="1">Tier 1 - Preferente</option>
            <option value="2">Tier 2</option>
            <option value="3">Tier 3</option>
            <option value="4" selected>Tier 4 - Nuevo</option>
        </select>
        <button type="submit" id="submit">Guardar Cliente</button>
    </form>
    <h2>Lista de Clientes</h2>
    <table border="1">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Dirección</th>
                <th>Ciudad</th>
                <th>Teléfono</th>
                <th>Email</th>
                <th>Tier</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="clientesLista"></tbody>
    </table>
    <script>
        const API_URL = '/api/clientes';
        document.getElementById('clienteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const clienteId = document.getElementById('clienteId').value;
            const cliente = {
                nombre_cliente: document.getElementById('nombre').value,
                direccion_cliente: document.getElementById('direccion').value,
                ciudad_estado_cliente: document.getElementById('ciudad').value,
                telefono_cliente: document.getElementById('telefono').value,
                email_cliente: document.getElementById('email').value,
                tier_cliente: parseInt(document.getElementById('tier').value)
            };
            try {
                let response;
                if (clienteId) {
                    response = await fetch(`${API_URL}/${clienteId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(cliente)
                    });
                } else {
                    response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(cliente)
                    });
                }
                if (!response.ok) throw new Error(await response.text());
                document.getElementById('clienteForm').reset();
                document.getElementById('clienteId').value = '';
                cargarClientes();
            } catch (error) {
                console.error('Error al guardar cliente:', error);
                alert('No se pudo guardar el cliente.');
            }
        });

        // Cargar la lista de clientes
        async function cargarClientes() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(await response.text());
                const clientes = await response.json();
                const lista = document.getElementById('clientesLista');
                lista.innerHTML = '';
                clientes.forEach((c) => {
                    lista.innerHTML += `
                        <tr>
                            <td>${c.nombre_cliente}</td>
                            <td>${c.direccion_cliente}</td>
                            <td>${c.ciudad_estado_cliente}</td>
                            <td>${c.telefono_cliente}</td>
                            <td>${c.email_cliente}</td>
                            <td>Tier ${c.tier_cliente}</td>
                            <td>
                                <button onclick="editarCliente('${c._id}', '${c.nombre_cliente}', '${c.direccion_cliente}', '${c.ciudad_estado_cliente}', '${c.telefono_cliente}', '${c.email_cliente}', ${c.tier_cliente})">Editar</button>
                                <button onclick="eliminarCliente('${c._id}')">Eliminar</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Error al cargar clientes:', error);
                alert('No se pudieron cargar los clientes.');
            }
        }

        // Editar cliente
        function editarCliente(id, nombre, direccion, ciudad, telefono, email, tier) {
            document.getElementById('clienteId').value = id;
            document.getElementById('nombre').value = nombre;
            document.getElementById('direccion').value = direccion;
            document.getElementById('ciudad').value = ciudad;
            document.getElementById('telefono').value = telefono;
            document.getElementById('email').value = email;
            document.getElementById('tier').value = tier;
            document.getElementById('submitBtn').innerText = 'Actualizar Cliente';
        }

        // Eliminar cliente
        async function eliminarCliente(id) {
            if (confirm('¿Seguro que deseas eliminar este cliente?')) {
                try {
                    const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                    if (!response.ok) throw new Error(await response.text());
                    cargarClientes();
                } catch (error) {
                    console.error('Error al eliminar cliente:', error);
                    alert('No se pudo eliminar el cliente.');
                }
            }
        }

        // Inicializar
        window.onload = cargarClientes;
    </script>
</body>
</html>
